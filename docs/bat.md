# bat脚本

## 1.echo和@

echo
|命令  |说明  |
|---------|---------|
|echo 文本内容     |     在命令行窗口打印命令内容    |
|echo on/off     |    打开或关闭回显功能     |
|echo.或echo,或echo:>文件    |    输出空行，相当于输入一个回车     |
|echo Y\|命令    |    确认执行某一命令     |
|echo>文件名     |    创建新文件     |
|echo 文件内容>>文件名     |     增加文件内容（一个>表示清空写入，两个表示追加写入）    |
|echo ^G|使喇叭鸣响|

@：表示本条命令不回显，仅在本条命令生效，优先级高于echo。
注意：echo在输出中文时会出现乱码，这时候只需要在开头添加chcp 65001即可。

## 2.rem和

**rem**：注释，支持echo回显。
**::**：注释，不支持echo回显，不能在**()**语句块中使用。

## 3.call和start

**call**：调用另一个批处理文件，执行完后返回当前文件并执行后续命令。
**start**：调用外部程序命令（该命令在新窗口中运行，同时批处理文件也继续执行）。直接运行外部程序则必须等待外部程序完成后才能继续执行后续命令。

## 4.pause

暂停并显示：请按任意键继续...
要显示其他提示语，可以这样用：echo 其他提示语 & pause > nul

## 5.errorlevel

程序返回码echo %errorlevel%
每个命令运行结束时都可以用这个命令查看返回码，用于判断刚才的命令是否执行成功，成功为0（默认值），失败为1。

## 6.goto和

批处理中允许以":xxx"来构建一个标号，然后用goto xxx跳转到该处，然后执行标号后的命令。

## 7.if条件

if条件有三种命令
|命令  |说明  |
|---------|---------|
|if [not] errorlevelnumber|根据返回码判断|
|if [not] string1 x string2|x处可以是equ（等于）/neq（不等于）/lss（小于）/leq（小于等于）/gtr（大于）/geq（大于等于）|
|if [not] exist filename|根据是否存在某文件然后判断|

## 8.for循环

```shell
for parameter %%variable in (set) do command command-parameters
```

参数说明：

- parameter有四个参数/d、/l、/r、/f
  <details markdown>
  <summary>参数说明</summary>
  <p>
  
  |参数  |说明  |
  |---------|---------|
  |/d     |遍历当前目录的所有文件夹         |
  |/l     |明确循环次数和步长，需要将(set)改为指定对象(start，step，end)，如(1,1,5)表示从1到5，步长为1         |
  |/r     |指定遍历范围为/r后的路径，遍历对象包括文件和文件夹（如果/r后没有路径则使用当前目录。如果set仅为一个单点字符或者具体的文件名，则忽略set）         |
  |/f     |遍历读取文件、字符串、命令行中指定内容并执行相应操作，对应的set为file-set/"string"/'commmand'         |
  
  -f具体格式：for /f "options" %%variable in (set) do command command-parameters
  |选项  |说明  |
  |---------|---------|
  |eol=c|以c开头的行不回显，默认为；|
  |skip=n|文件开始时忽略n行|
  |delims=xxx|分隔符为xxx|
  |tokens=x,y,m-n|每行的x，y被传递到for循环的变量中，范围是m-n|
  
  注意：options支持多个并列，中间用空格隔开。
  </p>
  </details>
- %%variable表示for循环中的变量，一般是%%i
- set指定某个或某类文件，支持通配符
- command指定执行的命令
- command-parameters为特定指令的参数

|参数  |说明  |
|---------|---------|
|%%~i|删除首尾的引号，扩展%i|
|%%~fi|将%i扩展到一个完全合格的路径名|
|%%~di|将%i扩展到驱动器名|
|%%~pi|将%i扩展到路径名，不包括驱动器|
|%%~ni|将%i扩展到文件名|
|%%~xi|将%i扩展到文件扩展名|
|%%~si|扩展的路径只含有短名|
|%%~ai|将%i扩展到文件属性|
|%%~ti|将%i扩展到文件日期/时间|
|%%~zi|将%i扩展到文件大小|
|%%~$PATH:i|查找列在PATH环境变量的目录，并将%i扩展到第一个完全合格的结果|

## 9.setlocal与变量延迟

批处理执行命令的顺序为读取-预处理（赋值）-执行，这样预处理后一旦发生变化，变化结果无法同步体现在执行结果中。例如：

```powershell
@echo off
set a=4
set a=5 & echo %a%
pause
```

输出结果为4。为了能让a读取最新的变化结果，需要引入延迟扩展，将a用两个!包裹起来。

```powershell
@echo off
setlocal enabledelayedexpansion
set a=4
set a=5 & echo !a!
pause
```

输出结果为5。

## 10.常用符号

|符号|名称|说明|
|--|--|--|
|%|批处理变量引导符|引用变量用%var%，调用外部参数用%1到%9，%0为批处理文件本身|
|`>|重定向符|>表示将命令发送到文件或设备，>>表示将命令输出添加到文件末尾而不删除文件中的已有信息，<表示从文件而非键盘获取命令所需输入|
|\||管道符|将第一条命令的结果作为第二条命令的参数来使用|
|`^|转义字符|作用于<,>,&|
|&,&&,\|\||命令组合|&表示A命令执行失败不影响B命令，&&表示A失败影响B，\|\|表示A失败才执行B|
|，和；|分隔符|逗号类似空格，分号用于分隔不同参数|
|!|变量延迟引用|详见[setlocal与变量延迟](#9setlocal与变量延迟)|
|+,-,*,/,%%|数学运算符|在set /a右边使用|

## 11.字符串处理

|命令|说明|
|--|--|
|%str:~start,count%|字符串截取，start表示开始位置（可以为负数），count表示截取长度|
|%str:old=new%|字符串局部替换|
|%str1%%str2%|字符串拼接|

## 12.文件操作

|操作|命令|
|--|--|
|创建文件（夹）|创建文件：echo>文件名；创建文件夹：md或者mkdir|
|删除文件（夹）|删除文件：del /p/q/a/f/s 文件名；删除文件夹：rd 文件夹名|
|重命名文件（夹）|ren path oldname newname，结合dir一起使用可以实现批量获取和修改文件名|
|复制和移动文件|复制文件：copy src dst或xcopy src dst /s/e/i/y（copy与xcopy的区别在于后者可以复制子目录）；移动文件：move src dst。如果move后加上-y，则表示覆盖目标文件（夹）。加上-y后不支持跨盘符分区操作。|
|查找文件内容|find /v/c/n/i "string" path filename|
|文件目录切换|cd /d path|

注意：删除命令中，/p表示删除前需要确认；/q表示安静模式，不需要确认；/a表示根据属性选择要删除的文件，属性包括r（只读）、a（存档）、s（系统）、h（隐藏）；/f表示强制删除只读文件；/s表示删除所有对应内容。更多关于不同命令的信息可以通过在cmd中输入command /？获取。

## 13.变量

### 13.1 系统变量

|命令|作用范围|说明|
|--|--|--|
|%ALLUSERSPROFILE%|本地|返回“所有用户”配置文件的位置。|
|%APPDATA%|本地|返回默认情况下应用程序存储数据的位置。|
|%CD%|本地|返回当前目录字符串。|
|%CMDCMDLINE%|本地|返回用来启动当前的 Cmd.exe 的准确命令行。|
|%CMDEXTVERSION%|系统|返回当前的“命令处理程序扩展”的版本号。|
|%COMPUTERNAME%|系统|返回计算机的名称。|
|%COMSPEC%|系统|返回命令行解释器可执行程序的准确路径。|
|%DATE%|系统|返回当前日期。|
|%ERRORLEVEL%|系统|返回上一条命令的错误代码。通常用非零值表示错误。|
|%HOMEDRIVE%|系统|返回连接到用户主目录的本地工作站驱动器号。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。|
|%HOMEPATH%|系统|返回用户主目录的完整路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。|
|%HOMESHARE%|系统|返回用户的共享主目录的网络路径。基于主目录值而设置。用户主目录是在“本地用户和组”中指定的。|
|%LOGONSERVER%|本地|返回验证当前登录会话的域控制器的名称。|
|%NUMBER_OF_PROCESSORS%|系统|指定安装在计算机上的处理器的数目。|
|%OS%|系统|返回操作系统名称。Windows 2000 显示其操作系统为 Windows_NT。|
|%PATH%|系统|指定可执行文件的搜索路径。|
|%PATHEXT%|系统|返回操作系统认为可执行的文件扩展名的列表。|
|%PROCESSOR_ARCHITECTURE%|系统|返回处理器的芯片体系结构。值：x86 或 IA64 基于Itanium|
|%PROCESSOR_IDENTFIER%|系统|返回处理器说明。|
|%PROCESSOR_LEVEL%|系统|返回计算机上安装的处理器的型号。|
|%PROCESSOR_REVISION%|系统|返回处理器的版本号。|
|%PROMPT%|本地|返回当前解释程序的命令提示符设置。由 Cmd.exe 生成。|
|%RANDOM%|系统|返回 0 到 32767 之间的任意十进制数字。由 Cmd.exe 生成。|
|%SYSTEMDRIVE%|系统|返回包含 Windows server operating system 根目录（即系统根目录）的驱动器。|
|%SYSTEMROOT%|系统|返回 Windows server operating system 根目录的位置。|
|%TEMP% 和 %TMP%|系统和用户|返回对当前登录用户可用的应用程序所使用的默认临时目录。有些应用程序需要 TEMP，而其他应用程序则需要 TMP。|
|%TIME%|系统|返回当前时间。|
|%USERDOMAIN%|本地|返回包含用户帐户的域的名称。|
|%USERNAME%|本地|返回当前登录的用户的名称。|
|%USERPROFILE%|本地|返回当前用户的配置文件的位置。|
|%WINDIR%|系统|返回操作系统目录的位置。|

### 13.2 环境变量

|命令|说明|
|-|-|
|set>test.txt|输出变量到文件|
|set xxx|查看环境变量xxx的位置|
|set xxx=C:\user|设置环境变量xxx|
|set xxx=|清除环境变量|

## 14.其他

在DOS环境中，可执行文件的优先级顺序为com>exe>bat>cmd